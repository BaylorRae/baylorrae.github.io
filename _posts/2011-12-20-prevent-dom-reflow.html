---
layout: post
title: Prevent DOM Reflow
date: 2011-12-20 14:29:43.000000000 -06:00
categories:
- Javascript
tags:
- createDocumentFragment
- how to
- javascript
- prevent
- reflow
meta:
  dsq_thread_id: '832389611'
---
<p>Javascript is a really laid back language. You can write a script a hundred different ways and most browsers don't care. However, as I found out there are consequences for not diligently writing proper code.</p>
<p>I turned Chris Coyier's <a href="https://github.com/chriscoyier/Relevant-Dropdowns">datalist pollyfill</a> into a jQuery plugin. Everything seemed perfect and I was rather self-impressed until I saw <a href="https://github.com/chriscoyier/Relevant-Dropdowns/issues/5">this issue</a>. I had never heard of <a href="http://dev.opera.com/articles/view/efficient-javascript/?page=3#reflow">DOM reflow</a> before and I was afraid it might be a difficult fix. But after a few google searches it turned out to be really easy.</p>
<h2>What was wrong exactly</h2>
<p>[gist id="3559658" file="problem.js"]</p>
<p>The problem generally occurs when you modify the DOM tree in a loop. In the code above you can see that I'm appending 12 <code>&lt;li&gt;</code>s to my <code>&lt;ol id="stuff"&gt;</code>. This means that the browser is going to update the layout of the DOM <strong>12</strong> times in a couple of seconds. That's a lot.</p>
<h2>The fix</h2>
<p>[gist id="3559658" file="fix.js"]</p>
<p>The best way to fix the problem is to modify the DOM as few times as possible. So I used <a href="https://developer.mozilla.org/en/DOM/document.createDocumentFragment">document.createDocumentFragment</a>. Why? Because the document fragment is not part of the DOM tree. Instead it stays in memory and holds all the items you append to it. Then when you're ready, you can append the <code>documentFragment</code> to <code>$stuff</code>.</p>
<h2>Take it a step further</h2>
<p>[gist id="3559658" file="going_further.js"]</p>
<p>Using <code>jQuery.each</code> isn't as fast as a traditional for loop <a href="http://baylorrae.com/wp-content/uploads/2011/12/Screen-Shot-2011-12-20-at-3.41.01-PM.png">[see my test results]</a>. You can run the same tests in your browser on <a href="http://jsperf.com/jquery-each-vs-for-loop/43">jsperf</a>. You may find it ironic that I care because I used <code>.split()</code> instead of writing an array, but I'm fine with it for this small example.</p>
