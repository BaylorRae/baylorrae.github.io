---
layout: post
title: PHP PubSub
date: 2011-12-21 08:00:29.000000000 -06:00
categories:
- PHP
- Snippets
- Tutorials
tags:
- example
- frameworks
- php
- pubsub
- tutorial
meta:
  dsq_thread_id: '835205007'
---
<p>A little over a year ago I read a post on Nettuts+ regarding <a href="http://net.tutsplus.com/tutorials/javascript-ajax/loose-coupling-with-the-pubsub-plugin/">PubSub with jQuery</a>. The idea is you create (or <strong>sub</strong>scribe to) a collection of functions that are called when you <strong>pub</strong>lish an event in your application.</p>
<p>It seems like something that only works in javascript because php doesn't deal with user events. But even WordPress implements a PubSub like system with <a href="http://codex.wordpress.org/Plugin_API/Action_Reference">action and filter hooks</a>.</p>
<h2>The problem</h2>
<p>On the surface PubSub looks a little redundant because you could use something like this in your application.</p>
<p>[gist id="3559713" file="problem.php"]</p>
<p>However, the above code isn't customizable. For instance, if this was packaged into a framework I would have to change the <em>core</em> files anytime I needed to change its functionality.</p>
<h2>The solution</h2>
<p>[gist id="3559713" file="concept.php"]</p>
<p>
{% gist baylorrae/3559713 concept.php %}
</p>
<p>Notice how I was able to extend the original <em>subscription</em> and do whatever I wanted with <code>$record_data</code>.</p>
<h2>A realistic example</h2>
<p>[gist id="3559713" file="realistic_example.php"]</p>
<p>Before you get all upset because I've assumed that everyone will adopt my code, please understand this. This article is a concept/tutorial on how to build this system. If you think your next project needs to implement PubSub you'll have this article as a starting point and as a guide.</p>
<h2>Let's Roll! Adding Subscriptions</h2>
<p>This is a very simple project. We're going to have a class that follows the <a href="http://php.net/manual/en/language.oop5.patterns.php#language.oop5.patterns.singleton">singleton pattern</a>. This way we don't have to pass a variable around in the application to keep up with all of the subscriptions.</p>
<p>[gist id="3559713" file="adding_subscriptions.php"]</p>
<p>We set the <code>__construct()</code> and <code>__clone()</code> methods to private so they cannot be called outside of the class. Even though we are not using them, it will break the script if the class is initialized and used.</p>
<p>The meat of the class so far is in the <code>subscribe()</code> method. Basically we are checking to see if the event has been subscribed to before. If it hasn't, then we create an empty array so we can push callbacks to it.</p>
<p>The <code>$events</code> variable looks like this after the script has run.</p>
<p>[gist id="3559713" file="result_1.php"]</p>
<h2>Publishing our subscriptions</h2>
<p>[gist id="3559713" file="publishing_subscriptions.php"]</p>
<p>The <code>publish()</code> method doesn't do a lot more that <code>subscribe()</code>. It first checks that the subscription has been set. Next it gets all the parameters passed except the first. Then it checks to see if there is only one <em>callable</em> event and calls it. But if there are multiple events, then it loops and calls each one of them.</p>
<h2>Unsubscribing</h2>
<p>[gist id="3559713" file="pubsub.php"]</p>
<p>This is dead simple. All we have to do is check if the subscription has been created and remove it.</p>
<p class="center"><a class="button" href="https://gist.github.com/1504836">View the final code on GitHub</a></p>
