---
layout: post
title: Adding a User Manager to your Feature Tests
date: 2016-11-18 08:30:14.000000000 -06:00
categories:
- Acceptance Testing
tags:
- acceptance tests
- cucumber
- selenium
- tdd
meta:
  dsq_thread_id: '5313060455'
---
<p>In my last post I described how to <a href="http://baylorrae.com/blog/2016/11/08/writing-acceptance-tests-in-third-person/">write declarative step definitions</a>. However, this means our test cases can't assume it knows who is performing the action because the user can change at any time. We'll need to introduce a sort of state machine to track the current user and log in as another user when needed.</p>
<p>I've written this example feature to purchase a product using a <strong>buyer</strong> and <strong>seller</strong> with the <strong>buyer</strong> performing two steps in a row.</p>
<p><script src="https://gist.github.com/BaylorRae/cedb1ccfb726fdca0b7e89c76ea8df47.js?file=purchase_product.feature"></script></p>
<p>When writing our step definitions we will include a capture group to get the username and then pass that to our <code>UserManager</code> class.</p>
<p><script src="https://gist.github.com/BaylorRae/cedb1ccfb726fdca0b7e89c76ea8df47.js?file=purchase_product_steps.rb"></script></p>
<p>Now for the final piece, the <code>UserManager</code> class. This is a very simple class with a single method to update the <code>current_username</code> variable if it is different. When this variable changes it will tell our <code>LoginPage</code> to log us in with the new username.</p>
<p><script src="https://gist.github.com/BaylorRae/cedb1ccfb726fdca0b7e89c76ea8df47.js?file=user_manager.rb"></script></p>
<p>As you can see this is a very small change to make and allows our step definitions to simply carry out the instructions from the high level scenario.</p>
