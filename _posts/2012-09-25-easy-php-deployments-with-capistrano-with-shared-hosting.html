---
layout: post
title: PHP+Capistrano+Shared Host = Easy Deployments
date: 2012-09-25 23:45:38.000000000 -05:00
categories:
- Capistrano
- Deployments
- PHP
- Shared Hosting
tags:
- capistrano
- deployments
- php
- shared hosting
- tutorial
meta:
  dsq_thread_id: '859641130'
---
<p>I wrote a Rails app that was deployed with Capistrano and I loved it. Every time I made a change, one file or a dozen, I could get all the files up in a single command. In addition, if anything was broken I could revert to the previous deploy with <code>cap deploy:rollback</code>.</p>
<p>While using Capistrano is considered a &quot;standard&quot; with Rails, it&#39;s something that I think should be used more with PHP as well. When I built my last website with PHP I reverted back to my FTP client deploys, and it was a nightmare. I worried about the order in which I uploaded each file and making sure I uploaded all of my changes.</p>
<p>I&#39;m aware of the services like <a href="http://beanstalkapp.com/">Beanstalk</a> that let you do a <code>git push</code> and will move the modified files for you. But, I&#39;m not a big fan of sharing my entire repository or giving access to my server. Plus, I&#39;m a little cheap, especially when I know I can write my own system for free. It may not be as fancy and it may require a little more work, but I like having complete control.</p>
<h2>The Requirement</h2>
<p>I don&#39;t want to explain how to make deployments with Capistrano. There are a lot of tutorials on the web that do a much better job than I can. So, if you&#39;re not familiar with Capistrano, you will need to follow a tutorial. The <a href="https://github.com/capistrano/capistrano/wiki">Capistrano Wiki</a> has quite a few resources that you may find helpful.</p>
<p>However, there is one modification that is far different than most Capistrano tutorials. On my shared host, I wasn&#39;t allowed to change the <code>DocumentRoot</code> for my primary domain. As a result, I had to create a symlink from <code>~/public_html</code> to the latest release on every deploy. While it sounds difficult, it&#39;s actually very easy.</p>
<h2>The Deployment Strategy</h2>
<p>This is where all the magic of Capistrano takes place. It&#39;s where you get to decide what takes place and when. You can define your entire deploy strategy here and Capistrano will make sure it happens, every time.</p>
<p><script src="https://gist.github.com/BaylorRae/3786042.js"></script></p>
<p>The most important change to the default deployment is on line 38. It deletes the default <code>~/public_html</code> directory and replaces it with a symlink to the latest release. A very simple command that makes the whole thing work.</p>
<p>The result is when I want to push the changes I made I can run <code>cap deploy</code> and my entire application is uploaded. I don&#39;t have to worry about individual files, and if something breaks I can always return to the previous release with <code>cap deploy:rollback</code>.</p>
