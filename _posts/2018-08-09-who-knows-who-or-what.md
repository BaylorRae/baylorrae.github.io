---
layout: post
title: Who Knows Who or What?
date: 2018-08-09 04:38:43.000000000 -05:00
categories:
- Natural Language Processing
tags:
- machine learning
- neural networks
- spacy
- nlp
---

A few years ago I had the opportunity to help build a social media platform
designed to connect professionals with various connections. The idea being to
index users based on companies or individuals they had previously mentioned
having a connection to.

While this is a problem I still don't fully understand it was especially
difficult for me back then. I'm writing this post for my future self and for
others facing a similar issue.

### The Solution

I think the end goal to this problem is basically building a graph database that
has the following connections `user -> (person, company or location)`. With this
design it is possible to perform a reverse lookup to find the fellow user with
the contacts you are looking for.

### Problem #1: Classifying Texts

The platform I worked on was strictly driven by unlabelled text. Posts could
be any of the following types **Question**, **Announcement**, **Search**,
**Poll** and didn't follow a template.

> *1.* "Does anyone have any recommendations for restaurants in X city?"

> *2.* "The company I work for is wanting to hire an intern for the summer. Please
> contact me at "x@y.com"

> *3.* "I'm looking for a contact at X company to promote Y product."

> *4.* "Which of these products do you think provide the best lift X, Y or Z?"

All of these texts are hand written without any *required* structure. This
makes classifying and therefore indexing the important information very
difficult.

I think the way we solve this first problem is is by applying [Part of Speech]
tagging overlayed with an [intent parser]. The idea is we look at the verbs in
correlation to types of entities they are modifying/connected to. These two
techniques should help us label the text.

<!-- Markup generated by spacy.displacy -->

<svg
xmlns="http://www.w3.org/2000/svg"
xmlns:xlink="http://www.w3.org/1999/xlink"
id="0"
class="displacy"
viewBox="0 0 950 350"
style="max-width: 100%; color: #000000; background: #ffffff; font-family: Arial; font-size: 30px"
>
<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="50">find</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="50" style="font-size: 16px">ROOT</tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="225">a</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="225"></tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="400">hotel</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="400"></tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="575">with</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="575"></tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="750">good</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="750"></tspan>
</text>

<text class="displacy-token" fill="currentColor" text-anchor="middle" y="309.5">
    <tspan class="displacy-word" fill="currentColor" x="925">wifi</tspan>
    <tspan class="displacy-tag" dy="2em" fill="currentColor" x="925"></tspan>
</text>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-0-1" stroke-width="2px" d="M70,264.5 C70,89.5 395.0,89.5 395.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 16px; letter-spacing: 1px">
        <textPath xlink:href="#arrow-0-1" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle">PLACE</textPath>
    </text>
    <path class="displacy-arrowhead" d="M395.0,266.5 L403.0,254.5 387.0,254.5" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-0-3" stroke-width="2px" d="M770,264.5 C770,177.0 915.0,177.0 915.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 16px; letter-spacing: 2px">
        <textPath xlink:href="#arrow-0-3" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle">QUALITY</textPath>
    </text>
    <path class="displacy-arrowhead" d="M770,266.5 L762,254.5 778,254.5" fill="currentColor"/>
</g>

<g class="displacy-arrow">
    <path class="displacy-arc" id="arrow-0-4" stroke-width="2px" d="M420,264.5 C420,2.0 925.0,2.0 925.0,264.5" fill="none" stroke="currentColor"/>
    <text dy="1.25em" style="font-size: 16px; letter-spacing: 1px">
        <textPath xlink:href="#arrow-0-4" class="displacy-label" startOffset="50%" fill="currentColor" text-anchor="middle">ATTRIBUTE</textPath>
    </text>
    <path class="displacy-arrowhead" d="M925.0,266.5 L933.0,254.5 917.0,254.5" fill="currentColor"/>
</g>
</svg>

### Problem #2: Extracting Entities

*Once we have labelled the text, next we need to extract the entities in
question.*

All of the above texts have important information to build our connections
database. In the first text, a question, we ask for recommendations in a city.
This is helps us identity that the user is likely making a trip to X city and
probably knows or would like to meet people in that city.

This information compounds itself since we will have likely extracted entities
from previous posts which would help us determine their likes and interests.

> "The following people are from X city and also like A, B and C."

This makes it realistic for us to create 'answers' or help other users find
questions they may be able to answer.

### Example Entity Extraction
<!-- Markup generated by spacy.displacy -->

<div class="entities" style="line-height: 2.5; margin-bottom: 1.5em;
font-family: sans-serif; background-color: #f2f2f2; text-align: center; padding:
0.5em">
<mark class="entity" style="background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em; box-decoration-break: clone; -webkit-box-decoration-break: clone">
    Apple
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">ORG</span>
</mark>
 is looking at buying 
<mark class="entity" style="background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em; box-decoration-break: clone; -webkit-box-decoration-break: clone">
    U.K.
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">GPE</span>
</mark>
 startup for 
<mark class="entity" style="background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em; box-decoration-break: clone; -webkit-box-decoration-break: clone">
    $1 billion
    <span style="font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; text-transform: uppercase; vertical-align: middle; margin-left: 0.5rem">MONEY</span>
</mark>
</div>

### Problem #3: Finding Answers

The last step to finding answers comes from inferring connections. This is
probably best solved with word embeddings such as [Word2Vec].

I think there's a good possibility we can start with a pretrained model from the
Wikipedia and/or Google News datasets. These models will help us gain insight
into the people, companies or locations and figure out how they are related.

<img
  style="width: 100%"
  src="{{ site.baseurl }}/assets/word2vec.png"
  alt="Word2Vec"
/>

The idea being that since we know the entities in a question (both the term and
the label) we can query our datasets to make predictions of who might have a
connection based on the relationships found in an unsupervised model from a
larger dataset.

It becomes even more interesting when you factor in that Word2Vec can also
perform mathematical operations to determine the resulting point. As we
improve our tagging of text it might be possible to create positive and negative
terms when searching for the most similar results.

<img
  style="width: 100%"
  src="{{ site.baseurl }}/assets/linear-relationships.png"
  alt="Word2Vec"
/>

### Conclusion

This post has been a bit abstract mostly because I haven't actually implemented
any of the things I mentioned above. After spending the last few months working
on document classification and working with [Spacy] I was reminded
of this previous project and thought I should log my initial ideas on solving
this problem again.

Sources:<br />
Model: https://codepen.io/explosion/pen/991f245ef90debb78c8fc369294f75ad<br />
Image: https://www.samyzaf.com/ML/nlp/word2vec2.png<br />
Image: https://www.tensorflow.org/tutorials/representation/word2vec

[Part of Speech]: https://spacy.io/usage/linguistic-features#pos-tagging
[intent parser]: https://spacy.io/usage/training#intent-parser
[Word2Vec]: https://en.wikipedia.org/wiki/Word2vec
[Spacy]: https://spacy.io
